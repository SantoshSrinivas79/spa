{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/snr/Desktop/Project/spa/imports/vue/ui/loanRepaymentForm.vue","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"/home/snr/Desktop/Project/spa/imports/vue/ui/loanRepaymentForm.vue","filename":"/home/snr/Desktop/Project/spa/imports/vue/ui/loanRepaymentForm.vue","passPerPreset":false,"envName":"development","cwd":"/home/snr/Desktop/Project/spa","root":"/home/snr/Desktop/Project/spa","generatorOpts":{"filename":"/home/snr/Desktop/Project/spa/imports/vue/ui/loanRepaymentForm.vue","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"/home/snr/Desktop/Project/spa/imports/vue/ui/loanRepaymentForm.vue"}},"code":"var compoLang;\nmodule.link(\"../../../both/i18n/lang/elem-label-loan\", {\n  \"default\": function (v) {\n    compoLang = v;\n  }\n}, 0);\nvar Loan_RepaymentReact;\nmodule.link(\"../../collection/loanRepayment\", {\n  Loan_RepaymentReact: function (v) {\n    Loan_RepaymentReact = v;\n  }\n}, 1);\nvar formatCurrency;\nmodule.link(\"../../../imports/api/methods/roundCurrency\", {\n  formatCurrency: function (v) {\n    formatCurrency = v;\n  }\n}, 2);\nvar formatCurrencyLast;\nmodule.link(\"../../../imports/api/methods/roundCurrency\", {\n  formatCurrencyLast: function (v) {\n    formatCurrencyLast = v;\n  }\n}, 3);\nvar GeneralFunction;\nmodule.link(\"../../../imports/api/methods/generalFunction\", {\n  GeneralFunction: function (v) {\n    GeneralFunction = v;\n  }\n}, 4);\nvar getCurrencySymbolById;\nmodule.link(\"../../../imports/api/methods/roundCurrency\", {\n  getCurrencySymbolById: function (v) {\n    getCurrencySymbolById = v;\n  }\n}, 5);\nvar WB_waterBillingSetup;\nmodule.link(\"../../collection/waterBillingSetup\", {\n  WB_waterBillingSetup: function (v) {\n    WB_waterBillingSetup = v;\n  }\n}, 6);\nvar Manage_Module;\nmodule.link(\"../../collection/manageModule\", {\n  Manage_Module: function (v) {\n    Manage_Module = v;\n  }\n}, 7);\nvar math;\nmodule.link(\"mathjs\", {\n  \"default\": function (v) {\n    math = v;\n  }\n}, 8);\nmodule.exportDefault({\n  meteor: {\n    langSession: function () {\n      return Session.get('lang') || \"en\";\n    },\n    disabledRemove: function () {\n      return Session.get(\"canRemove\");\n    },\n    disabledUpdate: function () {\n      return Session.get(\"canUpdate\");\n    },\n    newRe: function () {\n      var vm = this;\n      Loan_RepaymentReact.find({}).fetch();\n    }\n  },\n  mounted: function () {\n    this.$jQuery('body').off();\n  },\n  data: function () {\n    return {\n      langSession: null,\n      loanRepaymentForm: {\n        disbursementId: \"\",\n        currencyId: \"\",\n        repaymentDate: moment().toDate(),\n        paid: 0,\n        paidUSD: 0,\n        paidKHR: 0,\n        paidTHB: 0,\n        remainUSD: 0,\n        remainKHR: 0,\n        remainTHB: 0,\n        penalty: 0,\n        penaltyPaid: 0,\n        voucher: \"\",\n        note: \"\",\n        clientId: \"\",\n        type: \"Repayment\",\n        _id: \"\"\n      },\n      rules: {},\n      disbursementOption: [],\n      currencyOption: [{\n        label: \"USD\",\n        value: \"USD\"\n      }, {\n        label: \"KHR\",\n        value: \"KHR\"\n      }, {\n        label: \"THB\",\n        value: \"THB\"\n      }],\n      repaymentDoc: {},\n      skip: 0,\n      currencySymbol: \"\",\n      dayLate: 0,\n      balance: 0,\n      balanceNeedToPaidShow: 0,\n      isFee: false\n    };\n  },\n  watch: {\n    \"loanRepaymentForm.disbursementId\": function (val) {\n      this.getDisbursementById(val);\n    },\n    \"loanRepaymentForm.repaymentDate\": function (val) {\n      this.getVoucherByRoleAndDate(val);\n      this.getDisbursementById(this.loanRepaymentForm.disbursementId);\n      this.loanRepaymentForm.repaymentDate = val;\n    }\n  },\n  methods: {\n    customerOpt: function (query) {\n      var _this = this;\n\n      if (!!query) {\n        setTimeout(function () {\n          Meteor.call('queryLoanDisbursementOption', query, Session.get(\"area\"), function (err, result) {\n            if (!err) {\n              _this.disbursementOption = result;\n            } else {\n              console.log(err.message);\n            }\n          });\n        }, 200);\n      } else {\n        Meteor.call('queryLoanDisbursementOption', \"\", Session.get(\"area\"), function (err, result) {\n          if (!err) {\n            _this.disbursementOption = result;\n          } else {\n            console.log(err.message);\n          }\n        });\n      }\n    },\n    getCalculateAmountPaid: function (disbursementId) {\n      var _this2 = this;\n\n      var vm = this;\n      Meteor.call(\"getAmountNeedToPaid\", disbursementId, vm.loanRepaymentForm.repaymentDate, function (err, result) {\n        if (result) {\n          vm.repaymentDoc = result;\n          vm.loanRepaymentForm.clientId = result.clientId;\n\n          if (vm.loanRepaymentForm.repaymentDate && result.date) {\n            vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n          }\n\n          vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n\n          if (result && result.penaltyDoc && vm.dayLate > result.penaltyDoc.graceDay) {\n            var penaltyPerday;\n\n            if (result.currencyId === \"USD\") {\n              penaltyPerday = result.penaltyDoc.amountUSD;\n            } else if (result.currencyId === \"KHR\") {\n              penaltyPerday = result.penaltyDoc.amountKHR;\n            } else if (result.currencyId === \"THB\") {\n              penaltyPerday = result.penaltyDoc.amountTHB;\n            }\n\n            if (result.penaltyDoc.type === \"A\") {\n              vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * penaltyPerday, result.currencyId);\n            } else if (result.penaltyDoc.type === \"P\") {\n              vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n            }\n          } else {\n            vm.loanRepaymentForm.penalty = 0;\n          }\n\n          vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n          vm.loanRepaymentForm.remainUSD = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"USD\", vm.$_numeral(result.balanceUnpaid).value(), Session.get(\"area\")), \"USD\");\n          vm.loanRepaymentForm.remainKHR = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"KHR\", vm.$_numeral(result.balanceUnpaid).value(), Session.get(\"area\")), \"KHR\");\n          vm.loanRepaymentForm.remainTHB = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"THB\", vm.$_numeral(result.balanceUnpaid).value(), Session.get(\"area\")), \"THB\");\n\n          if (result.currencyId === \"USD\") {\n            vm.loanRepaymentForm.paidUSD = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, \"USD\")).value();\n            vm.loanRepaymentForm.paidKHR = 0;\n            vm.loanRepaymentForm.paidTHB = 0;\n          } else if (result.currencyId === \"KHR\") {\n            vm.loanRepaymentForm.paidUSD = 0;\n            vm.loanRepaymentForm.paidKHR = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, \"KHR\")).value();\n            vm.loanRepaymentForm.paidTHB = 0;\n          } else if (result.currencyId === \"THB\") {\n            vm.loanRepaymentForm.paidUSD = 0;\n            vm.loanRepaymentForm.paidKHR = 0;\n            vm.loanRepaymentForm.paidTHB = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, \"THB\")).value();\n          } else {\n            vm.loanRepaymentForm.paidUSD = 0;\n            \"\";\n            vm.loanRepaymentForm.paidKHR = 0;\n            vm.loanRepaymentForm.paidTHB = 0;\n          }\n\n          _this2.getTotal();\n        }\n      });\n    },\n    getCalculateFeePaid: function (disbursementId) {\n      var vm = this;\n      Meteor.call(\"getFeeNeedToPaid\", disbursementId, function (err, result) {\n        if (result) {\n          vm.repaymentDoc = result;\n          vm.loanRepaymentForm.clientId = result.clientId;\n\n          if (vm.loanRepaymentForm.repaymentDate && result.date) {\n            vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n          }\n\n          vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n          vm.loanRepaymentForm.penalty = 0;\n          vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n          vm.loanRepaymentForm.remainUSD = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"USD\", vm.$_numeral(result.feeAmount).value(), Session.get(\"area\")), \"USD\");\n          vm.loanRepaymentForm.remainKHR = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"KHR\", vm.$_numeral(result.feeAmount).value(), Session.get(\"area\")), \"KHR\");\n          vm.loanRepaymentForm.remainTHB = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"THB\", vm.$_numeral(result.feeAmount).value(), Session.get(\"area\")), \"THB\");\n\n          if (result.currencyId === \"USD\") {\n            vm.loanRepaymentForm.paidUSD = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, \"USD\")).value();\n            vm.loanRepaymentForm.paidKHR = 0;\n            vm.loanRepaymentForm.paidTHB = 0;\n          } else if (result.currencyId === \"KHR\") {\n            vm.loanRepaymentForm.paidUSD = 0;\n            vm.loanRepaymentForm.paidKHR = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, \"KHR\")).value();\n            vm.loanRepaymentForm.paidTHB = 0;\n          } else if (result.currencyId === \"THB\") {\n            vm.loanRepaymentForm.paidUSD = 0;\n            vm.loanRepaymentForm.paidKHR = 0;\n            vm.loanRepaymentForm.paidTHB = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, \"THB\")).value();\n          } else {\n            vm.loanRepaymentForm.paidUSD = 0;\n            \"\";\n            vm.loanRepaymentForm.paidKHR = 0;\n            vm.loanRepaymentForm.paidTHB = 0;\n          }\n\n          vm.getTotal();\n        }\n      });\n    },\n    getTotal: function () {\n      var vm = this;\n\n      if (vm.isFee === false) {\n        vm.balance = vm.repaymentDoc.balanceUnpaid - GeneralFunction.exchange(\"USD\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidUSD, Session.get(\"area\")) - GeneralFunction.exchange(\"KHR\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidKHR, Session.get(\"area\")) - GeneralFunction.exchange(\"THB\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidTHB, Session.get(\"area\"));\n      } else {\n        vm.balance = vm.repaymentDoc.feeAmount - GeneralFunction.exchange(\"USD\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidUSD, Session.get(\"area\")) - GeneralFunction.exchange(\"KHR\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidKHR, Session.get(\"area\")) - GeneralFunction.exchange(\"THB\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidTHB, Session.get(\"area\"));\n      }\n\n      vm.loanRepaymentForm.remainUSD = formatCurrencyLast(GeneralFunction.exchange(vm.repaymentDoc.currencyId, \"USD\", vm.$_numeral(vm.balance).value(), Session.get(\"area\")), \"USD\");\n      vm.loanRepaymentForm.remainKHR = formatCurrencyLast(GeneralFunction.exchange(vm.repaymentDoc.currencyId, \"KHR\", vm.$_numeral(vm.balance).value(), Session.get(\"area\")), \"KHR\");\n      vm.loanRepaymentForm.remainTHB = formatCurrencyLast(GeneralFunction.exchange(vm.repaymentDoc.currencyId, \"THB\", vm.$_numeral(vm.balance).value(), Session.get(\"area\")), \"THB\");\n      vm.balanceNeedToPaidShow = formatCurrencyLast(vm.loanRepaymentForm.penaltyPaid + GeneralFunction.exchange(\"USD\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidUSD, Session.get(\"area\")) + GeneralFunction.exchange(\"KHR\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidKHR, Session.get(\"area\")) + GeneralFunction.exchange(\"THB\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidTHB, Session.get(\"area\")));\n    },\n    getVoucherByRoleAndDate: function (date) {\n      var vm = this;\n      Meteor.call(\"loan_getVoucherNoByRoleAndDate\", Session.get(\"area\"), date, function (err, result) {\n        if (!err) {\n          vm.loanRepaymentForm.voucher = result;\n        }\n      });\n    },\n    getDisbursementById: function (id) {\n      var vm = this;\n      Meteor.call(\"queryLoanDisbursementById\", id, function (err, result) {\n        if (result) {\n          vm.isFee = math.round(result.feeAmount - result.paidFeeAmount) > 0;\n          console.log(vm.isFee);\n          console.log(result.feeAmount - result.paidFeeAmount);\n\n          if (vm.isFee === true) {\n            vm.repaymentDoc.disbursementDoc = result;\n            vm.loanRepaymentForm.type = \"Fee\";\n            vm.dayLate = 0;\n            vm.getCalculateFeePaid(id);\n          } else {\n            vm.getCalculateAmountPaid(id);\n            vm.loanRepaymentForm.type = \"Repayment\";\n          }\n        }\n      });\n    },\n    saveLoanRepayment: function (event) {\n      var _this3 = this;\n\n      event.preventDefault();\n      var vm = this;\n      this.$refs[\"loanRepaymentForm\"].validate(function (valid) {\n        if (valid) {\n          var paid = 0;\n          var totalPaid = 0;\n\n          if (vm.loanRepaymentForm.type === \"Fee\") {\n            var temPaid = vm.$_numeral(vm.repaymentDoc.feeAmount).value() - vm.getRemainAmountByCurrency(vm.repaymentDoc.currencyId, vm.$_numeral(vm.loanRepaymentForm.remainUSD).value(), vm.$_numeral(vm.loanRepaymentForm.remainKHR).value(), vm.$_numeral(vm.loanRepaymentForm.remainTHB).value());\n            paid = temPaid <= 0 ? 0 : temPaid;\n            totalPaid = paid;\n          } else {\n            var _temPaid = vm.$_numeral(vm.repaymentDoc.balanceUnpaid).value() - vm.getRemainAmountByCurrency(vm.repaymentDoc.currencyId, vm.$_numeral(vm.loanRepaymentForm.remainUSD).value(), vm.$_numeral(vm.loanRepaymentForm.remainKHR).value(), vm.$_numeral(vm.loanRepaymentForm.remainTHB).value());\n\n            paid = _temPaid <= 0 ? 0 : _temPaid;\n            totalPaid = paid + vm.$_numeral(vm.loanRepaymentForm.penaltyPaid).value();\n          }\n\n          var loanRepaymentDoc = {\n            disbursementId: vm.loanRepaymentForm.disbursementId,\n            currencyId: vm.repaymentDoc.currencyId,\n            repaymentDate: vm.loanRepaymentForm.repaymentDate,\n            paidUSD: vm.$_numeral(vm.loanRepaymentForm.paidUSD).value(),\n            paidKHR: vm.$_numeral(vm.loanRepaymentForm.paidKHR).value(),\n            paidTHB: vm.$_numeral(vm.loanRepaymentForm.paidTHB).value(),\n            remainUSD: vm.$_numeral(vm.loanRepaymentForm.remainUSD).value(),\n            remainKHR: vm.$_numeral(vm.loanRepaymentForm.remainKHR).value(),\n            remainTHB: vm.$_numeral(vm.loanRepaymentForm.remainTHB).value(),\n            penalty: vm.$_numeral(vm.loanRepaymentForm.penalty).value(),\n            penaltyPaid: vm.$_numeral(vm.loanRepaymentForm.penaltyPaid).value(),\n            voucher: vm.loanRepaymentForm.voucher,\n            note: vm.loanRepaymentForm.note,\n            type: vm.loanRepaymentForm.type,\n            dayLate: vm.dayLate,\n            clientId: vm.loanRepaymentForm.clientId,\n            paid: vm.$_numeral(formatCurrencyLast(paid, vm.repaymentDoc.currencyId)).value(),\n            totalPaid: vm.$_numeral(formatCurrencyLast(totalPaid, vm.repaymentDoc.currencyId)).value(),\n            rolesArea: Session.get('area')\n          };\n          Meteor.call(\"insertLoanRepayment\", loanRepaymentDoc, function (err, result) {\n            if (!err) {\n              vm.$message({\n                duration: 1000,\n                message: _this3.langConfig['saveSuccess'],\n                type: 'success'\n              });\n              vm.resetForm();\n            } else {\n              vm.$message({\n                duration: 1000,\n                message: err.message,\n                type: 'error'\n              });\n            }\n          });\n        }\n      });\n    },\n    getRemainAmountByCurrency: function (currency, usd, khr, thb) {\n      if (currency === \"USD\") {\n        return usd;\n      } else if (currency === \"KHR\") {\n        return khr;\n      } else if (currency === \"THB\") {\n        return thb;\n      }\n    },\n    cancel: function () {\n      this.$message({\n        type: 'info',\n        message: this.langConfig['cancel']\n      });\n    },\n    resetForm: function () {\n      this.loanRepaymentForm.disbursementId = \"\";\n      this.loanRepaymentForm.repaymentDate = moment().toDate();\n      this.loanRepaymentForm.paidUSD = 0;\n      this.loanRepaymentForm.paidKHR = 0;\n      this.loanRepaymentForm.paidTHB = 0;\n      this.loanRepaymentForm.remainUSD = 0;\n      this.loanRepaymentForm.remainKHR = 0;\n      this.loanRepaymentForm.remainTHB = 0;\n      this.loanRepaymentForm.penalty = 0;\n      this.loanRepaymentForm.penaltyPaid = 0;\n      this.balanceNeedToPaidShow = 0;\n      this.loanRepaymentForm.note = \"\";\n      this.repaymentDoc = {};\n    }\n  },\n  created: function () {\n    this.customerOpt();\n    this.getVoucherByRoleAndDate(moment().toDate());\n  },\n  computed: {\n    langConfig: function () {\n      var _this4 = this;\n\n      var data = compoLang.filter(function (config) {\n        return config.lang === _this4.langSession;\n      })[0]['repayment'];\n      return data;\n    }\n  }\n});","map":{"version":3,"sources":["/home/snr/Desktop/Project/spa/imports/vue/ui/loanRepaymentForm.vue"],"names":["compoLang","module","link","v","Loan_RepaymentReact","formatCurrency","formatCurrencyLast","GeneralFunction","getCurrencySymbolById","WB_waterBillingSetup","Manage_Module","math","exportDefault","meteor","langSession","Session","get","disabledRemove","disabledUpdate","newRe","vm","find","fetch","mounted","$jQuery","off","data","loanRepaymentForm","disbursementId","currencyId","repaymentDate","moment","toDate","paid","paidUSD","paidKHR","paidTHB","remainUSD","remainKHR","remainTHB","penalty","penaltyPaid","voucher","note","clientId","type","_id","rules","disbursementOption","currencyOption","label","value","repaymentDoc","skip","currencySymbol","dayLate","balance","balanceNeedToPaidShow","isFee","watch","val","getDisbursementById","getVoucherByRoleAndDate","methods","customerOpt","query","setTimeout","Meteor","call","err","result","console","log","message","getCalculateAmountPaid","date","startOf","add","diff","penaltyDoc","graceDay","penaltyPerday","amountUSD","amountKHR","amountTHB","principleUnpaid","exchange","$_numeral","balanceUnpaid","getTotal","getCalculateFeePaid","feeAmount","id","round","paidFeeAmount","disbursementDoc","saveLoanRepayment","event","preventDefault","$refs","validate","valid","totalPaid","temPaid","getRemainAmountByCurrency","loanRepaymentDoc","rolesArea","$message","duration","langConfig","resetForm","currency","usd","khr","thb","cancel","created","computed","filter","config","lang"],"mappings":"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","sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n    import compoLang from '../../../both/i18n/lang/elem-label-loan'\n    import {Loan_RepaymentReact} from \"../../collection/loanRepayment\";\n    import {formatCurrency} from \"../../../imports/api/methods/roundCurrency\";\n    import {formatCurrencyLast} from \"../../../imports/api/methods/roundCurrency\";\n    import {GeneralFunction} from \"../../../imports/api/methods/generalFunction\";\n    import {getCurrencySymbolById} from \"../../../imports/api/methods/roundCurrency\";\n    import {WB_waterBillingSetup} from \"../../collection/waterBillingSetup\";\n    import {Manage_Module} from \"../../collection/manageModule\";\n    import math from \"mathjs\";\n\n    export default {\n        meteor: {\n            langSession() {\n                return Session.get('lang') || \"en\";\n            },\n            disabledRemove() {\n                return Session.get(\"canRemove\");\n            },\n            disabledUpdate() {\n                return Session.get(\"canUpdate\");\n            },\n            newRe() {\n                let vm = this;\n                Loan_RepaymentReact.find({}).fetch();\n            }\n        },\n        mounted() {\n            this.$jQuery('body').off();\n\n        },\n        data() {\n            return {\n                langSession: null,\n                loanRepaymentForm: {\n                    disbursementId: \"\",\n                    currencyId: \"\",\n                    repaymentDate: moment().toDate(),\n                    paid: 0,\n                    paidUSD: 0,\n                    paidKHR: 0,\n                    paidTHB: 0,\n                    remainUSD: 0,\n                    remainKHR: 0,\n                    remainTHB: 0,\n                    penalty: 0,\n                    penaltyPaid: 0,\n                    voucher: \"\",\n                    note: \"\",\n                    clientId: \"\",\n                    type: \"Repayment\",\n                    _id: \"\"\n                },\n                rules: {},\n                disbursementOption: [],\n                currencyOption: [\n                    {label: \"USD\", value: \"USD\"},\n                    {label: \"KHR\", value: \"KHR\"},\n                    {label: \"THB\", value: \"THB\"},\n                ],\n                repaymentDoc: {},\n                skip: 0,\n                currencySymbol: \"\",\n                dayLate: 0,\n                balance: 0,\n                balanceNeedToPaidShow: 0,\n                isFee: false\n            }\n        },\n        watch: {\n            \"loanRepaymentForm.disbursementId\"(val) {\n                this.getDisbursementById(val);\n            },\n            \"loanRepaymentForm.repaymentDate\"(val) {\n                this.getVoucherByRoleAndDate(val);\n                this.getDisbursementById(this.loanRepaymentForm.disbursementId);\n                this.loanRepaymentForm.repaymentDate = val;\n            }\n        },\n        methods: {\n            customerOpt(query) {\n                if (!!query) {\n                    setTimeout(() => {\n                        Meteor.call('queryLoanDisbursementOption', query, Session.get(\"area\"), (err, result) => {\n                            if (!err) {\n                                this.disbursementOption = result;\n                            } else {\n                                console.log(err.message);\n                            }\n                        })\n                    }, 200);\n                } else {\n                    Meteor.call('queryLoanDisbursementOption', \"\", Session.get(\"area\"), (err, result) => {\n                        if (!err) {\n                            this.disbursementOption = result;\n                        } else {\n                            console.log(err.message);\n                        }\n                    })\n                }\n            },\n            getCalculateAmountPaid(disbursementId) {\n                let vm = this;\n                Meteor.call(\"getAmountNeedToPaid\", disbursementId, vm.loanRepaymentForm.repaymentDate, (err, result) => {\n                    if (result) {\n                        vm.repaymentDoc = result;\n                        vm.loanRepaymentForm.clientId = result.clientId;\n\n                        if (vm.loanRepaymentForm.repaymentDate && result.date) {\n                            vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n                        }\n                        vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n\n                        if (result && result.penaltyDoc && vm.dayLate > result.penaltyDoc.graceDay) {\n                            let penaltyPerday;\n                            if (result.currencyId === \"USD\") {\n                                penaltyPerday = result.penaltyDoc.amountUSD;\n                            } else if (result.currencyId === \"KHR\") {\n                                penaltyPerday = result.penaltyDoc.amountKHR;\n                            } else if (result.currencyId === \"THB\") {\n                                penaltyPerday = result.penaltyDoc.amountTHB;\n                            }\n\n                            if (result.penaltyDoc.type === \"A\") {\n                                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * penaltyPerday, result.currencyId);\n                            } else if (result.penaltyDoc.type === \"P\") {\n                                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n                            }\n                        } else {\n                            vm.loanRepaymentForm.penalty = 0;\n                        }\n\n\n                        vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n                        vm.loanRepaymentForm.remainUSD = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"USD\", vm.$_numeral(result.balanceUnpaid).value(), Session.get(\"area\")), \"USD\");\n                        vm.loanRepaymentForm.remainKHR = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"KHR\", vm.$_numeral(result.balanceUnpaid).value(), Session.get(\"area\")), \"KHR\");\n                        vm.loanRepaymentForm.remainTHB = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"THB\", vm.$_numeral(result.balanceUnpaid).value(), Session.get(\"area\")), \"THB\");\n                        if (result.currencyId === \"USD\") {\n                            vm.loanRepaymentForm.paidUSD = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, \"USD\")).value();\n                            vm.loanRepaymentForm.paidKHR = 0;\n                            vm.loanRepaymentForm.paidTHB = 0;\n                        } else if (result.currencyId === \"KHR\") {\n                            vm.loanRepaymentForm.paidUSD = 0;\n                            vm.loanRepaymentForm.paidKHR = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, \"KHR\")).value();\n                            vm.loanRepaymentForm.paidTHB = 0;\n\n\n                        } else if (result.currencyId === \"THB\") {\n                            vm.loanRepaymentForm.paidUSD = 0;\n                            vm.loanRepaymentForm.paidKHR = 0;\n                            vm.loanRepaymentForm.paidTHB = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, \"THB\")).value();\n                        } else {\n                            vm.loanRepaymentForm.paidUSD = 0;\n                            ``\n                            vm.loanRepaymentForm.paidKHR = 0;\n                            vm.loanRepaymentForm.paidTHB = 0;\n                        }\n                        this.getTotal();\n                    }\n                })\n            },\n            getCalculateFeePaid(disbursementId) {\n                let vm = this;\n                Meteor.call(\"getFeeNeedToPaid\", disbursementId, (err, result) => {\n                    if (result) {\n                        vm.repaymentDoc = result;\n                        vm.loanRepaymentForm.clientId = result.clientId;\n\n                        if (vm.loanRepaymentForm.repaymentDate && result.date) {\n                            vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n                        }\n                        vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n                        vm.loanRepaymentForm.penalty = 0;\n\n\n                        vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n                        vm.loanRepaymentForm.remainUSD = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"USD\", vm.$_numeral(result.feeAmount).value(), Session.get(\"area\")), \"USD\");\n                        vm.loanRepaymentForm.remainKHR = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"KHR\", vm.$_numeral(result.feeAmount).value(), Session.get(\"area\")), \"KHR\");\n                        vm.loanRepaymentForm.remainTHB = formatCurrencyLast(GeneralFunction.exchange(result.currencyId, \"THB\", vm.$_numeral(result.feeAmount).value(), Session.get(\"area\")), \"THB\");\n                        if (result.currencyId === \"USD\") {\n                            vm.loanRepaymentForm.paidUSD = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, \"USD\")).value();\n                            vm.loanRepaymentForm.paidKHR = 0;\n                            vm.loanRepaymentForm.paidTHB = 0;\n                        } else if (result.currencyId === \"KHR\") {\n                            vm.loanRepaymentForm.paidUSD = 0;\n                            vm.loanRepaymentForm.paidKHR = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, \"KHR\")).value();\n                            vm.loanRepaymentForm.paidTHB = 0;\n\n\n                        } else if (result.currencyId === \"THB\") {\n                            vm.loanRepaymentForm.paidUSD = 0;\n                            vm.loanRepaymentForm.paidKHR = 0;\n                            vm.loanRepaymentForm.paidTHB = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, \"THB\")).value();\n                        } else {\n                            vm.loanRepaymentForm.paidUSD = 0;\n                            ``\n                            vm.loanRepaymentForm.paidKHR = 0;\n                            vm.loanRepaymentForm.paidTHB = 0;\n                        }\n                        vm.getTotal();\n                    }\n                })\n            },\n            getTotal() {\n                let vm = this;\n                if (vm.isFee === false) {\n                    vm.balance = vm.repaymentDoc.balanceUnpaid - GeneralFunction.exchange(\"USD\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidUSD, Session.get(\"area\")) - GeneralFunction.exchange(\"KHR\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidKHR, Session.get(\"area\")) - GeneralFunction.exchange(\"THB\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidTHB, Session.get(\"area\"));\n\n                } else {\n                    vm.balance = vm.repaymentDoc.feeAmount - GeneralFunction.exchange(\"USD\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidUSD, Session.get(\"area\")) - GeneralFunction.exchange(\"KHR\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidKHR, Session.get(\"area\")) - GeneralFunction.exchange(\"THB\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidTHB, Session.get(\"area\"));\n                }\n\n                vm.loanRepaymentForm.remainUSD = formatCurrencyLast(GeneralFunction.exchange(vm.repaymentDoc.currencyId, \"USD\", vm.$_numeral(vm.balance).value(), Session.get(\"area\")), \"USD\");\n                vm.loanRepaymentForm.remainKHR = formatCurrencyLast(GeneralFunction.exchange(vm.repaymentDoc.currencyId, \"KHR\", vm.$_numeral(vm.balance).value(), Session.get(\"area\")), \"KHR\");\n                vm.loanRepaymentForm.remainTHB = formatCurrencyLast(GeneralFunction.exchange(vm.repaymentDoc.currencyId, \"THB\", vm.$_numeral(vm.balance).value(), Session.get(\"area\")), \"THB\");\n\n                vm.balanceNeedToPaidShow = formatCurrencyLast(vm.loanRepaymentForm.penaltyPaid + GeneralFunction.exchange(\"USD\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidUSD, Session.get(\"area\")) + GeneralFunction.exchange(\"KHR\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidKHR, Session.get(\"area\")) + GeneralFunction.exchange(\"THB\", vm.repaymentDoc.currencyId, vm.loanRepaymentForm.paidTHB, Session.get(\"area\")));\n            },\n            getVoucherByRoleAndDate(date) {\n                let vm = this;\n                Meteor.call(\"loan_getVoucherNoByRoleAndDate\", Session.get(\"area\"), date, (err, result) => {\n                    if (!err) {\n                        vm.loanRepaymentForm.voucher = result;\n                    }\n                })\n            },\n            getDisbursementById(id) {\n                let vm = this;\n                Meteor.call(\"queryLoanDisbursementById\", id, (err, result) => {\n                    if (result) {\n                        vm.isFee = math.round(result.feeAmount - result.paidFeeAmount) > 0;\n                        console.log(vm.isFee);\n                        console.log((result.feeAmount - result.paidFeeAmount));\n                        if (vm.isFee === true) {\n                            vm.repaymentDoc.disbursementDoc = result;\n                            vm.loanRepaymentForm.type = \"Fee\";\n                            vm.dayLate = 0;\n                            vm.getCalculateFeePaid(id);\n                        } else {\n                            vm.getCalculateAmountPaid(id);\n                            vm.loanRepaymentForm.type = \"Repayment\";\n\n                        }\n                    }\n                })\n            },\n            saveLoanRepayment(event) {\n                event.preventDefault();\n                let vm = this;\n                this.$refs[\"loanRepaymentForm\"].validate((valid) => {\n                    if (valid) {\n                        let paid = 0;\n                        let totalPaid = 0;\n\n                        if (vm.loanRepaymentForm.type === \"Fee\") {\n\n                            let temPaid = vm.$_numeral(vm.repaymentDoc.feeAmount).value() - vm.getRemainAmountByCurrency(vm.repaymentDoc.currencyId, vm.$_numeral(vm.loanRepaymentForm.remainUSD).value(), vm.$_numeral(vm.loanRepaymentForm.remainKHR).value(), vm.$_numeral(vm.loanRepaymentForm.remainTHB).value());\n                            paid = temPaid <= 0 ? 0 : temPaid;\n                            totalPaid = paid;\n                        } else {\n                            let temPaid = vm.$_numeral(vm.repaymentDoc.balanceUnpaid).value() - vm.getRemainAmountByCurrency(vm.repaymentDoc.currencyId, vm.$_numeral(vm.loanRepaymentForm.remainUSD).value(), vm.$_numeral(vm.loanRepaymentForm.remainKHR).value(), vm.$_numeral(vm.loanRepaymentForm.remainTHB).value());\n                            paid = temPaid <= 0 ? 0 : temPaid;\n\n                            totalPaid = paid + vm.$_numeral(vm.loanRepaymentForm.penaltyPaid).value();\n\n                        }\n\n                        let loanRepaymentDoc = {\n                            disbursementId: vm.loanRepaymentForm.disbursementId,\n                            currencyId: vm.repaymentDoc.currencyId,\n                            repaymentDate: vm.loanRepaymentForm.repaymentDate,\n                            paidUSD: vm.$_numeral(vm.loanRepaymentForm.paidUSD).value(),\n                            paidKHR: vm.$_numeral(vm.loanRepaymentForm.paidKHR).value(),\n                            paidTHB: vm.$_numeral(vm.loanRepaymentForm.paidTHB).value(),\n                            remainUSD: vm.$_numeral(vm.loanRepaymentForm.remainUSD).value(),\n                            remainKHR: vm.$_numeral(vm.loanRepaymentForm.remainKHR).value(),\n                            remainTHB: vm.$_numeral(vm.loanRepaymentForm.remainTHB).value(),\n                            penalty: vm.$_numeral(vm.loanRepaymentForm.penalty).value(),\n                            penaltyPaid: vm.$_numeral(vm.loanRepaymentForm.penaltyPaid).value(),\n                            voucher: vm.loanRepaymentForm.voucher,\n                            note: vm.loanRepaymentForm.note,\n                            type: vm.loanRepaymentForm.type,\n                            dayLate: vm.dayLate,\n                            clientId: vm.loanRepaymentForm.clientId,\n                            paid: vm.$_numeral(formatCurrencyLast(paid, vm.repaymentDoc.currencyId)).value(),\n                            totalPaid: vm.$_numeral(formatCurrencyLast(totalPaid, vm.repaymentDoc.currencyId)).value(),\n                            rolesArea: Session.get('area')\n\n                        };\n\n                        Meteor.call(\"insertLoanRepayment\", loanRepaymentDoc, (err, result) => {\n                            if (!err) {\n                                vm.$message({\n                                    duration: 1000,\n                                    message: this.langConfig['saveSuccess'],\n                                    type: 'success'\n                                });\n                                vm.resetForm();\n                            } else {\n                                vm.$message({\n                                    duration: 1000,\n                                    message: err.message,\n                                    type: 'error'\n                                });\n                            }\n                        })\n                    }\n                })\n\n            },\n            getRemainAmountByCurrency(currency, usd, khr, thb) {\n                if (currency === \"USD\") {\n                    return usd;\n                } else if (currency === \"KHR\") {\n                    return khr;\n                } else if (currency === \"THB\") {\n                    return thb;\n                }\n            },\n            cancel() {\n                this.$message({\n                    type: 'info',\n                    message: this.langConfig['cancel']\n                });\n            },\n            resetForm() {\n                this.loanRepaymentForm.disbursementId = \"\";\n                this.loanRepaymentForm.repaymentDate = moment().toDate();\n                this.loanRepaymentForm.paidUSD = 0;\n                this.loanRepaymentForm.paidKHR = 0;\n                this.loanRepaymentForm.paidTHB = 0;\n\n                this.loanRepaymentForm.remainUSD = 0;\n                this.loanRepaymentForm.remainKHR = 0;\n                this.loanRepaymentForm.remainTHB = 0;\n                this.loanRepaymentForm.penalty = 0;\n                this.loanRepaymentForm.penaltyPaid = 0;\n                this.balanceNeedToPaidShow = 0;\n                this.loanRepaymentForm.note = \"\";\n                this.repaymentDoc = {};\n\n            }\n        },\n        created() {\n            this.customerOpt();\n            this.getVoucherByRoleAndDate(moment().toDate());\n\n        },\n        computed: {\n            langConfig() {\n                let data = compoLang.filter(config => config.lang === this.langSession)[0]['repayment'];\n                return data;\n            }\n        }\n    }\n"]},"sourceType":"script","hash":"ed158054a531d952d78152d9df00078cb61bed1a"}
